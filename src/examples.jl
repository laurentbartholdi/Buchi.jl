# examples of useful transducers

export grigorchuk, tribonacci, fibonacci, thuemorse

function grigorchuk()
    transitions = [5=>(1,1)=>5,5=>(2,2)=>5,4=>(1,2)=>5,4=>(2,1)=>5,3=>(1,1)=>4,3=>(2,2)=>2,2=>(1,1)=>4,2=>(2,2)=>1,1=>(1,1)=>5,1=>(2,2)=>3]
    d = CBuchiAutomaton(transitions)
    (a = reinitialize(d,4), b = reinitialize(d,3), c = reinitialize(d,5), d)
end

function tribonacci()
    proj = CBuchiAutomaton(2=>(1,1)=>2,2=>(2,2)=>3,3=>(3,3)=>2,3=>(4,4)=>4,4=>(5,5)=>2,
                           5=>(3,5)=>2,6=>(1,3)=>2,6=>(2,4)=>5,7=>(5,2)=>6,8=>(4,1)=>7,9=>(2,1)=>8,7=>(5,1)=>9,
                           1=>(3,5)=>2,1=>(1,3)=>2,1=>(2,4)=>5,1=>(5,2)=>6,1=>(4,1)=>7,1=>(2,1)=>8,1=>(5,1)=>9)

    proj‚ÇÇ = CBuchiAutomaton(2=>1=>2,2=>2=>3,3=>3=>2,3=>4=>4,4=>5=>2,
                              1=>1=>2,1=>2=>3,1=>3=>2,1=>4=>4,1=>5=>2)

    add = CBuchiAutomaton(2=>('z','z')=>4,3=>('x','x')=>2,3=>('b','b')=>5,3=>('c','c')=>6,4=>('y','y')=>3,
    5=>('x','x')=>2,5=>('y','y')=>3,5=>('z','z')=>4,6=>('b','b')=>5,
    7=>('x','x')=>2,8=>('y','y')=>3,9=>('z','z')=>4,10=>('y','b')=>7,10=>('z','b')=>8,10=>('x','b')=>9,10=>('y','c')=>6,
    10=>('y','x')=>11,11=>('c','z')=>12,12=>('b','y')=>10,
    1=>('y','b')=>7,1=>('z','b')=>8,1=>('x','b')=>9,1=>('y','c')=>6,1=>('y','x')=>11,1=>('c','z')=>12,1=>('b','y')=>10)

    add‚ÇÅ = CBuchiAutomaton(2=>('z','z')=>4,3=>('x','x')=>2,3=>('b','b')=>5,3=>('c','c')=>6,4=>('y','y')=>3,
                           5=>('x','x')=>2,5=>('y','y')=>3,5=>('z','z')=>4,6=>('b','b')=>5,
                           1=>('x','x')=>2,1=>('y','y')=>3,1=>('z','z')=>4,1=>('b','b')=>5,1=>('c','c')=>6)

    (proj, proj‚ÇÇ, add, add‚ÇÅ)
end

function fibonacci()
    add = CBuchiAutomaton(2=>('x','x')=>3,2=>('b','b')=>4,3=>('y','y')=>2,4=>('x','x')=>3,4=>('y','y')=>2,
  6=>('x','x')=>3,5=>('y','y')=>2,
  7=>('x','b')=>5,7=>('y','b')=>6,7=>('y','x')=>8,8=>('b','y')=>7,
  1=>('x','b')=>5,1=>('y','b')=>6,1=>('y','x')=>8,1=>('b','y')=>7)

    add‚ÇÅ = CBuchiAutomaton(2=>('x','x')=>3,2=>('b','b')=>4,3=>('y','y')=>2,4=>('x','x')=>3,4=>('y','y')=>2,
    1=>('y','y')=>2,1=>('x','x')=>3,1=>('b','b')=>4)

    (add, add‚ÇÅ)
end

# The Thue-Morse subshift, just encoding the positive part.
# we don't yet have B√ºchi automata, so we simulate the termination condition
# by having the letter ùüé‚Ä≤ having to appear at the end.

function thuemorse()
    # the alphabet itself
    id = CBuchiAutomaton(2=>:ùüéa=>2,2=>:ùüèb=>3,3=>:ùüèa=>2,3=>:ùüéb=>3,
        1=>:ùüéa=>2,1=>:ùüèb=>3,1=>:ùüèa=>2,1=>:ùüéb=>3)

# the generator, i.e. the one-sided shift
    add = CBuchiAutomaton(2=>(:ùüéa,:ùüéa)=>2,2=>(:ùüèb,:ùüèb)=>3,3=>(:ùüèa,:ùüèa)=>2,3=>(:ùüéb,:ùüéb)=>3,
        4=>(:ùüéa,:ùüèa)=>2,4=>(:ùüèb,:ùüéb)=>6,5=>(:ùüéb,:ùüèb)=>3,5=>(:ùüèa,:ùüéa)=>7,6=>(:ùüèa,:ùüéb)=>4,7=>(:ùüèb,:ùüéa)=>5,
        1=>(:ùüéa,:ùüèa)=>2,1=>(:ùüèb,:ùüéb)=>6,1=>(:ùüéb,:ùüèb)=>3,1=>(:ùüèa,:ùüéa)=>7,1=>(:ùüèa,:ùüéb)=>4,1=>(:ùüèb,:ùüéa)=>5)

# the encoding of the action
    ùüé,ùüè,ùüé‚Ä≤ = :ùüé,:ùüè,:ùüé‚Ä≤
    action = CBuchiAutomaton(2=>(:ùüéa,:ùüéa,ùüé‚Ä≤)=>2,2=>(:ùüèb,:ùüèb,ùüé‚Ä≤)=>3,3=>(:ùüèa,:ùüèa,ùüé‚Ä≤)=>2,3=>(:ùüéb,:ùüéb,ùüé‚Ä≤)=>3,
        4=>(:ùüéa,:ùüèa,ùüé‚Ä≤)=>2,4=>(:ùüèb,:ùüéb,ùüé‚Ä≤)=>6,5=>(:ùüéb,:ùüèb,ùüé‚Ä≤)=>3,5=>(:ùüèa,:ùüéa,ùüé‚Ä≤)=>7,6=>(:ùüèa,:ùüéb,ùüé‚Ä≤)=>4,7=>(:ùüèb,:ùüéa,ùüé‚Ä≤)=>5,
        8=>(:ùüéa,:ùüèa,ùüè)=>2,8=>(:ùüèb,:ùüéb,ùüè)=>6,9=>(:ùüéb,:ùüèb,ùüè)=>3,9=>(:ùüèa,:ùüéa,ùüè)=>7,10=>(:ùüèa,:ùüéb,ùüè)=>4,11=>(:ùüèb,:ùüéa,ùüè)=>5,
        8=>(:ùüéa,:ùüéb,ùüé)=>8,8=>(:ùüèb,:ùüèa,ùüé)=>9,9=>(:ùüéb,:ùüéa,ùüé)=>9,9=>(:ùüèa,:ùüèb,ùüé)=>8,
        10=>(:ùüéb,:ùüéb,ùüé)=>10,10=>(:ùüèa,:ùüèa,ùüé)=>11,11=>(:ùüéa,:ùüéa,ùüé)=>11,11=>(:ùüèb,:ùüèb,ùüé)=>10,
        4=>(:ùüéa,:ùüéb,ùüè)=>4,4=>(:ùüèb,:ùüèa,ùüè)=>5,5=>(:ùüèa,:ùüèb,ùüè)=>4,5=>(:ùüéb,:ùüéa,ùüè)=>5,
  4=>(:ùüéa,:ùüèa,ùüé)=>11,5=>(:ùüéb,:ùüèb,ùüé)=>10,6=>(:ùüéb,:ùüèa,ùüé)=>9,7=>(:ùüéa,:ùüèb,ùüé)=>8,
  6=>(:ùüéb,:ùüéb,ùüè)=>6,6=>(:ùüèa,:ùüèa,ùüè)=>7,7=>(:ùüèb,:ùüèb,ùüè)=>6,7=>(:ùüéa,:ùüéa,ùüè)=>7,
  8=>(:ùüéa,:ùüèa,ùüè)=>11,9=>(:ùüéb,:ùüèb,ùüè)=>10,10=>(:ùüéb,:ùüèa,ùüè)=>9,11=>(:ùüéa,:ùüèb,ùüè)=>8,

  1=>(:ùüéa,:ùüéa,ùüé‚Ä≤)=>2,1=>(:ùüèb,:ùüèb,ùüé‚Ä≤)=>3,1=>(:ùüèa,:ùüèa,ùüé‚Ä≤)=>2,1=>(:ùüéb,:ùüéb,ùüé‚Ä≤)=>3,
  1=>(:ùüéa,:ùüèa,ùüè)=>2,1=>(:ùüèb,:ùüéb,ùüè)=>6,1=>(:ùüéb,:ùüèb,ùüè)=>3,1=>(:ùüèa,:ùüéa,ùüè)=>7,1=>(:ùüèa,:ùüéb,ùüè)=>4,1=>(:ùüèb,:ùüéa,ùüè)=>5,
  1=>(:ùüéa,:ùüéb,ùüé)=>8,1=>(:ùüèb,:ùüèa,ùüé)=>9,1=>(:ùüéb,:ùüéa,ùüé)=>9,1=>(:ùüèa,:ùüèb,ùüé)=>8,
  1=>(:ùüéb,:ùüéb,ùüé)=>10,1=>(:ùüèa,:ùüèa,ùüé)=>11,1=>(:ùüéa,:ùüéa,ùüé)=>11,1=>(:ùüèb,:ùüèb,ùüé)=>10,
  1=>(:ùüéa,:ùüèa,ùüè)=>11,1=>(:ùüéb,:ùüèb,ùüè)=>10,1=>(:ùüéb,:ùüèa,ùüè)=>9,1=>(:ùüéa,:ùüèb,ùüè)=>8,
)

    binadder = CBuchiAutomaton(1=>(ùüé‚Ä≤,ùüé‚Ä≤,ùüé‚Ä≤)=>1,1=>(ùüè,ùüè,ùüé‚Ä≤)=>1,1=>(ùüé‚Ä≤,ùüè,ùüè)=>1,1=>(ùüè,ùüé‚Ä≤,ùüè)=>2,
        2=>(ùüé‚Ä≤,ùüè,ùüé‚Ä≤)=>1,2=>(ùüé‚Ä≤,ùüé‚Ä≤,ùüè)=>2,2=>(ùüè,ùüé‚Ä≤,ùüé‚Ä≤)=>2,2=>(ùüè,ùüè,ùüè)=>2)

    (id, add, action, binadder)
end

function int2buchibin(n)
    s = 1
    x = Pair{Int,Pair{Tuple{Symbol},Int}}[]
    while n>0
        if iseven(n)
            push!(x,s=>(ùüé,)=>s+1)
            push!(x,s=>(ùüé‚Ä≤,)=>s+1)
        else
            push!(x,s=>(ùüè,)=>s+1)
        end
        s += 1
        n √∑= 2
    end
    push!(x,s=>(ùüé‚Ä≤,)=>s)
    CBuchiAutomaton(x)
end

#@assert thuemorseaction*CBuchiAutomaton(OmegaWord([ùüé‚Ä≤])) == Buchi.diagonal(thuemorse‚ÇÄ)
#@assert all(i->thuemorseaction*int2buchibin(i) == thuemorse^i,1:10)

# fibonacci
function fibo2()
    fib_adder = CBuchiAutomaton(1=>(0,0,0)=>2,1=>(0,0,1)=>3,1=>(0,1,0)=>4,1=>(0,1,1)=>5,1=>(1,0,0)=>6,1=>(1,0,1)=>7,1=>(1,1,0)=>8,1=>(1,1,1)=>9,
2=>(0,0,0)=>2,2=>(0,0,1)=>10,2=>(0,1,0)=>11,2=>(0,1,1)=>5,2=>(1,0,0)=>12,2=>(1,0,1)=>7,2=>(1,1,1)=>9,
3=>(0,0,0)=>13,3=>(0,1,0)=>14,3=>(1,0,0)=>14,3=>(1,1,0)=>8,
4=>(0,0,0)=>14,4=>(0,0,1)=>13,4=>(1,0,0)=>15,
5=>(0,0,0)=>2,5=>(1,0,0)=>12,
6=>(0,0,0)=>14,6=>(0,0,1)=>13,6=>(0,1,0)=>16,
7=>(0,0,0)=>2,7=>(0,1,0)=>11,
8=>(0,0,0)=>17,8=>(0,0,1)=>18,
9=>(0,0,0)=>14,
10=>(0,0,0)=>13,
11=>(0,0,0)=>14,11=>(1,0,0)=>15,
12=>(0,0,0)=>14,12=>(0,1,0)=>16,
13=>(0,1,0)=>14,13=>(1,0,0)=>14,13=>(1,1,0)=>8,
14=>(0,0,1)=>13,
15=>(0,0,0)=>17,15=>(0,0,1)=>18,15=>(0,1,1)=>11,
16=>(0,0,0)=>17,16=>(0,0,1)=>18,16=>(1,0,1)=>12,
17=>(0,0,0)=>14,17=>(0,1,0)=>16,17=>(1,0,0)=>15,17=>(1,1,0)=>19,17=>(1,1,1)=>20,
18=>(0,0,0)=>2,18=>(0,1,0)=>11,18=>(1,0,0)=>12,
19=>(0,0,0)=>21,
20=>(0,0,0)=>17,
21=>(0,0,0)=>17,21=>(0,0,1)=>18,21=>(0,1,1)=>11,21=>(1,0,1)=>12)

# negative fibonacci base

    negafib_adder = CBuchiAutomaton(
1=>(0,0,0)=>2,1=>(0,0,1)=>3,1=>(0,1,0)=>4,1=>(0,1,1)=>5,1=>(1,0,1)=>5,1=>(1,0,0)=>6,1=>(1,1,0)=>7,1=>(1,1,1)=>8,
2=>(0,0,0)=>9,2=>(0,0,1)=>3,2=>(0,1,1)=>5,2=>(1,0,1)=>5,2=>(1,1,0)=>8,
3=>(0,0,0)=>10,3=>(0,1,0)=>4,3=>(1,0,0)=>6,3=>(1,1,0)=>7,
4=>(0,0,0)=>11,4=>(1,0,0)=>12,4=>(1,0,1)=>13,
5=>(0,0,0)=>9,
6=>(0,0,0)=>11,6=>(0,1,0)=>14,6=>(0,1,1)=>15,
7=>(0,0,0)=>16,7=>(0,0,1)=>17,
8=>(0,0,0)=>11,
9=>(0,0,0)=>9,9=>(0,0,1)=>3,9=>(0,1,1)=>5,9=>(1,0,1)=>5,
10=>(1,1,0)=>8,
11=>(0,0,0)=>10,11=>(0,1,0)=>4,11=>(1,0,0)=>6,11=>(1,1,0)=>7,11=>(1,1,1)=>8,
12=>(0,0,0)=>9,12=>(0,0,1)=>3,12=>(0,1,1)=>5,
13=>(0,0,0)=>10,13=>(0,1,0)=>4,
14=>(0,0,0)=>9,14=>(0,0,1)=>3,14=>(1,0,1)=>5,
15=>(0,0,0)=>10,15=>(1,0,0)=>6,
16=>(0,0,1)=>5,
17=>(0,0,0)=>18,17=>(0,1,0)=>7,17=>(1,0,0)=>7,
18=>(0,0,0)=>11,18=>(0,1,0)=>14,18=>(0,1,1)=>15,18=>(1,0,0)=>12,18=>(1,0,1)=>13,18=>(1,1,1)=>5)

    negafib_gen = CBuchiAutomaton(1=>(0, 0)=>2, 1=>(0, 1)=>3, 1=>(1, 0)=>4,
  2=>(1, 0)=>5, 3=>(0, 0)=>6, 4=>(0, 0)=>7, 4=>(0, 1)=>8,
  5=>(0, 0)=>6, 6=>(0, 0)=>6, 6=>(1, 1)=>3,
                                  7=>(0, 1)=>3, 8=>(0, 0)=>2, 8=>(1, 0)=>4)

    (fib_adder, negafib_adder, negafib_gen)
end

function thuemorse_spot()
    # the alphabet itself
    factory = APDictFactory(3,[:ùüéa,:ùüèa,:ùüéb,:ùüèb,:ùüé,:ùüè])
    ùüé,ùüè = :ùüé,:ùüè
    
    id = SpotAutomaton(factory[],1=>:ùüéa=>1,1=>:ùüèb=>2,2=>:ùüèa=>1,2=>:ùüéb=>2,
        0=>:ùüéa=>1,0=>:ùüèb=>2,0=>:ùüèa=>1,0=>:ùüéb=>2)

# the generator, i.e. the one-sided shift
    increment = SpotAutomaton(factory[2],2=>(:ùüéa,:ùüéa)=>2,2=>(:ùüèb,:ùüèb)=>3,3=>(:ùüèa,:ùüèa)=>2,3=>(:ùüéb,:ùüéb)=>3,
        4=>(:ùüéa,:ùüèa)=>2,4=>(:ùüèb,:ùüéb)=>6,5=>(:ùüéb,:ùüèb)=>3,5=>(:ùüèa,:ùüéa)=>1,6=>(:ùüèa,:ùüéb)=>4,1=>(:ùüèb,:ùüéa)=>5,
        0=>(:ùüéa,:ùüèa)=>2,0=>(:ùüèb,:ùüéb)=>6,0=>(:ùüéb,:ùüèb)=>3,0=>(:ùüèa,:ùüéa)=>1,0=>(:ùüèa,:ùüéb)=>4,0=>(:ùüèb,:ùüéa)=>5)

# the encoding of the action
    action = SpotAutomaton(factory[3],AcceptBuchi(),
        2=>((:ùüéa,:ùüéa,ùüé),0)=>2,2=>((:ùüèb,:ùüèb,ùüé),0)=>3,3=>((:ùüèa,:ùüèa,ùüé),0)=>2,3=>((:ùüéb,:ùüéb,ùüé),0)=>3,
        4=>((:ùüéa,:ùüèa,ùüé),0)=>2,4=>((:ùüèb,:ùüéb,ùüé),0)=>6,5=>((:ùüéb,:ùüèb,ùüé),0)=>3,5=>((:ùüèa,:ùüéa,ùüé),0)=>7,6=>((:ùüèa,:ùüéb,ùüé),0)=>4,7=>((:ùüèb,:ùüéa,ùüé),0)=>5,
        8=>(:ùüéa,:ùüèa,ùüè)=>2,8=>(:ùüèb,:ùüéb,ùüè)=>6,9=>(:ùüéb,:ùüèb,ùüè)=>3,9=>(:ùüèa,:ùüéa,ùüè)=>7,10=>(:ùüèa,:ùüéb,ùüè)=>4,1=>(:ùüèb,:ùüéa,ùüè)=>5,
        8=>(:ùüéa,:ùüéb,ùüé)=>8,8=>(:ùüèb,:ùüèa,ùüé)=>9,9=>(:ùüéb,:ùüéa,ùüé)=>9,9=>(:ùüèa,:ùüèb,ùüé)=>8,
        10=>(:ùüéb,:ùüéb,ùüé)=>10,10=>(:ùüèa,:ùüèa,ùüé)=>1,1=>(:ùüéa,:ùüéa,ùüé)=>1,1=>(:ùüèb,:ùüèb,ùüé)=>10,
        4=>(:ùüéa,:ùüéb,ùüè)=>4,4=>(:ùüèb,:ùüèa,ùüè)=>5,5=>(:ùüèa,:ùüèb,ùüè)=>4,5=>(:ùüéb,:ùüéa,ùüè)=>5,
        4=>(:ùüéa,:ùüèa,ùüé)=>1,5=>(:ùüéb,:ùüèb,ùüé)=>10,6=>(:ùüéb,:ùüèa,ùüé)=>9,7=>(:ùüéa,:ùüèb,ùüé)=>8,
        6=>(:ùüéb,:ùüéb,ùüè)=>6,6=>(:ùüèa,:ùüèa,ùüè)=>7,7=>(:ùüèb,:ùüèb,ùüè)=>6,7=>(:ùüéa,:ùüéa,ùüè)=>7,
        8=>(:ùüéa,:ùüèa,ùüè)=>1,9=>(:ùüéb,:ùüèb,ùüè)=>10,10=>(:ùüéb,:ùüèa,ùüè)=>9,1=>(:ùüéa,:ùüèb,ùüè)=>8,

        0=>(:ùüéa,:ùüéa,ùüé)=>2,0=>(:ùüèb,:ùüèb,ùüé)=>3,0=>(:ùüèa,:ùüèa,ùüé)=>2,0=>(:ùüéb,:ùüéb,ùüé)=>3,
        0=>(:ùüéa,:ùüèa,ùüè)=>2,0=>(:ùüèb,:ùüéb,ùüè)=>6,0=>(:ùüéb,:ùüèb,ùüè)=>3,0=>(:ùüèa,:ùüéa,ùüè)=>7,0=>(:ùüèa,:ùüéb,ùüè)=>4,0=>(:ùüèb,:ùüéa,ùüè)=>5,
        0=>(:ùüéa,:ùüéb,ùüé)=>8,0=>(:ùüèb,:ùüèa,ùüé)=>9,0=>(:ùüéb,:ùüéa,ùüé)=>9,0=>(:ùüèa,:ùüèb,ùüé)=>8,
        0=>(:ùüéb,:ùüéb,ùüé)=>10,0=>(:ùüèa,:ùüèa,ùüé)=>1,0=>(:ùüéa,:ùüéa,ùüé)=>1,0=>(:ùüèb,:ùüèb,ùüé)=>10,
        0=>(:ùüéa,:ùüèa,ùüè)=>1,0=>(:ùüéb,:ùüèb,ùüè)=>10,0=>(:ùüéb,:ùüèa,ùüè)=>9,0=>(:ùüéa,:ùüèb,ùüè)=>8)

    binadder = SpotAutomaton(factory[3],0=>(ùüé,ùüé,ùüé)=>0,0=>(ùüè,ùüè,ùüé)=>0,0=>(ùüé,ùüè,ùüè)=>0,0=>(ùüè,ùüé,ùüè)=>1,
        1=>(ùüé,ùüè,ùüé)=>0,1=>(ùüé,ùüé,ùüè)=>1,1=>(ùüè,ùüé,ùüé)=>1,1=>(ùüè,ùüè,ùüè)=>1)

    int2word = n->begin
        s = 1
        preperiod = Symbol[]
        while n>0
            push!(preperiod, iseven(n) ? ùüé : ùüè)
            n √∑= 2
        end
        SpotOmegaWord(factory[],preperiod,[ùüé])
    end
    
    (factory = factory, id, increment, action, binadder, int2word)
end

function substitutive(œï::Dict{Char,String})
    Œ£‚ÇÄ = keys(œï) |> collect |> sort
    N = length(Œ£‚ÇÄ)
    alphabet = Dict{Any,Int}(c=>n for (n,c)=enumerate(Œ£‚ÇÄ))
    for (m,c)=enumerate(Œ£‚ÇÄ), (n,d)=enumerate(Œ£‚ÇÄ)
        alphabet[c,d] = m*N+n
    end
    Œ£ = [Symbol(c,'ùüé'+i) for c=Œ£‚ÇÄ for i=0:length(œï[c])-1]

    factory = APDictFactory(3,Œ£)
    id = let trans = Pair{Int,Pair{Symbol,Int}}[]
        for c=Œ£‚ÇÄ, i=0:length(œï[c])-1
            d = collect(œï[c])[i+1]
            push!(trans,alphabet[d]=>Symbol(c,'ùüé'+i)=>alphabet[c])
            push!(trans,0=>Symbol(c,'ùüé'+i)=>alphabet[c])
        end
        SpotAutomaton(factory[], N+1, trans)
    end

    increment = let trans = Pair{Int,Pair{NTuple{2,Symbol},Int}}[]
        for c=Œ£‚ÇÄ, i=0:length(œï[c])-1
            d = collect(œï[c])[i+1]
            push!(trans,alphabet[d]=>(Symbol(c,'ùüé'+i),Symbol(c,'ùüé'+i))=>alphabet[c])
        end
        for c=Œ£‚ÇÄ, i=0:length(œï[c])-2
            d‚ÇÄ = collect(œï[c])[i+1]
            d‚ÇÅ = collect(œï[c])[i+2]
            push!(trans,alphabet[d‚ÇÄ,d‚ÇÅ]=>(Symbol(c,'ùüé'+i),Symbol(c,'ùüé'+i+1))=>alphabet[c])
        end
        for c‚ÇÄ=Œ£‚ÇÄ, c‚ÇÅ=Œ£‚ÇÄ
            d‚ÇÄ = collect(œï[c‚ÇÄ])[end]
            d‚ÇÅ = collect(œï[c‚ÇÅ])[1]
            push!(trans,alphabet[d‚ÇÄ,d‚ÇÅ]=>(Symbol(c‚ÇÄ,'ùüé'+length(œï[c])-1),Symbol(c‚ÇÅ,'ùüé'))=>alphabet[c‚ÇÄ,c‚ÇÅ])
            push!(trans,0=>(Symbol(c‚ÇÄ,'ùüé'+length(œï[c])-1),Symbol(c‚ÇÅ,'ùüé'))=>alphabet[c‚ÇÄ,c‚ÇÅ])
        end
    end
    (factory = factory, Œ£‚ÇÄ, Œ£, id, increment)
end
